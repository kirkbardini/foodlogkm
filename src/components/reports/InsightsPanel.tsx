import React from 'react';
import { Card } from '../ui/Card';

interface InsightsPanelProps {
  currentTotals: {
    protein_g: number;
    carbs_g: number;
    fat_g: number;
    kcal: number;
    water_ml: number;
  };
  goals: {
    protein_g: number;
    carbs_g: number;
    fat_g: number;
    kcal: number;
    water_ml: number;
  };
}

export const InsightsPanel: React.FC<InsightsPanelProps> = ({
  currentTotals,
  goals
}) => {
  const getInsights = () => {
    const insights = [];
    
    // Fun√ß√£o para determinar status baseado no tipo de macro
    const getMacroStatus = (percentage: number, macroType: string) => {
      switch (macroType.toLowerCase()) {
        case 'prote√≠na':
        case 'prote√≠nas':
          if (percentage < 85) return 'very-low';
          if (percentage <= 94) return 'low';
          if (percentage <= 110) return 'target';
          if (percentage <= 120) return 'above';
          return 'excess';
        
        case 'carboidrato':
        case 'carboidratos':
          if (percentage < 70) return 'very-low';
          if (percentage <= 84) return 'low';
          if (percentage <= 100) return 'target';
          if (percentage <= 105) return 'above';
          return 'excess';
        
        case 'gordura':
        case 'gorduras':
          if (percentage < 70) return 'very-low';
          if (percentage <= 84) return 'low';
          if (percentage <= 100) return 'target';
          if (percentage <= 110) return 'above';
          return 'excess';
        
        case 'caloria':
        case 'calorias':
          if (percentage < 90) return 'very-low';
          if (percentage <= 96) return 'low';
          if (percentage <= 103) return 'target';
          if (percentage <= 107) return 'above';
          return 'excess';
        
        case '√°gua':
        case 'agua':
          if (percentage < 75) return 'very-low';
          if (percentage <= 90) return 'low';
          if (percentage <= 130) return 'target';
          if (percentage <= 150) return 'above';
          return 'excess';
        
        default:
          return 'target';
      }
    };
    
    // An√°lise de prote√≠nas
    const proteinPercentage = (currentTotals.protein_g / goals.protein_g) * 100;
    const proteinStatus = getMacroStatus(proteinPercentage, 'prote√≠na');
    
    if (proteinStatus === 'very-low') {
      insights.push({
        type: 'warning',
        icon: 'üî¥',
        title: 'Prote√≠na muito baixa',
        message: `Voc√™ consumiu apenas ${proteinPercentage.toFixed(0)}% da meta de prote√≠na. Adicione carnes, ovos ou leguminosas.`
      });
    } else if (proteinStatus === 'low') {
      insights.push({
        type: 'warning',
        icon: 'üü†',
        title: 'Prote√≠na baixa',
        message: `Voc√™ consumiu ${proteinPercentage.toFixed(0)}% da meta de prote√≠na. Considere adicionar mais fontes proteicas.`
      });
    } else if (proteinStatus === 'target') {
      insights.push({
        type: 'success',
        icon: '‚úÖ',
        title: 'Prote√≠na em dia!',
        message: `Excelente! Voc√™ atingiu ${proteinPercentage.toFixed(0)}% da meta de prote√≠na.`
      });
    } else if (proteinStatus === 'above') {
      insights.push({
        type: 'info',
        icon: 'üü°',
        title: 'Prote√≠na acima da meta',
        message: `Voc√™ consumiu ${proteinPercentage.toFixed(0)}% da meta de prote√≠na. Est√° um pouco acima, mas ainda dentro do aceit√°vel.`
      });
    } else if (proteinStatus === 'excess') {
      insights.push({
        type: 'warning',
        icon: '‚ö†Ô∏è',
        title: 'Prote√≠na em excesso',
        message: `Voc√™ consumiu ${proteinPercentage.toFixed(0)}% da meta de prote√≠na. Considere reduzir a ingest√£o proteica.`
      });
    }

    // An√°lise de carboidratos
    const carbsPercentage = (currentTotals.carbs_g / goals.carbs_g) * 100;
    const carbsStatus = getMacroStatus(carbsPercentage, 'carboidrato');
    
    if (carbsStatus === 'very-low') {
      insights.push({
        type: 'warning',
        icon: 'üî¥',
        title: 'Carboidratos muito baixos',
        message: `Voc√™ consumiu apenas ${carbsPercentage.toFixed(0)}% da meta de carboidratos. Adicione arroz, batata ou frutas.`
      });
    } else if (carbsStatus === 'low') {
      insights.push({
        type: 'warning',
        icon: 'üü†',
        title: 'Carboidratos baixos',
        message: `Voc√™ consumiu ${carbsPercentage.toFixed(0)}% da meta de carboidratos. Considere adicionar mais fontes energ√©ticas.`
      });
    } else if (carbsStatus === 'target') {
      insights.push({
        type: 'success',
        icon: '‚úÖ',
        title: 'Carboidratos em dia!',
        message: `Excelente! Voc√™ atingiu ${carbsPercentage.toFixed(0)}% da meta de carboidratos.`
      });
    } else if (carbsStatus === 'above') {
      insights.push({
        type: 'info',
        icon: 'üü°',
        title: 'Carboidratos acima da meta',
        message: `Voc√™ consumiu ${carbsPercentage.toFixed(0)}% da meta de carboidratos. Est√° um pouco acima, mas ainda dentro do aceit√°vel.`
      });
    } else if (carbsStatus === 'excess') {
      insights.push({
        type: 'warning',
        icon: '‚ö†Ô∏è',
        title: 'Carboidratos em excesso',
        message: `Voc√™ consumiu ${carbsPercentage.toFixed(0)}% da meta de carboidratos. Considere reduzir a ingest√£o.`
      });
    }

    // An√°lise de gorduras
    const fatPercentage = (currentTotals.fat_g / goals.fat_g) * 100;
    const fatStatus = getMacroStatus(fatPercentage, 'gordura');
    
    if (fatStatus === 'very-low') {
      insights.push({
        type: 'warning',
        icon: 'üî¥',
        title: 'Gorduras muito baixas',
        message: `Voc√™ consumiu apenas ${fatPercentage.toFixed(0)}% da meta de gorduras. Adicione azeite, abacate ou castanhas.`
      });
    } else if (fatStatus === 'low') {
      insights.push({
        type: 'warning',
        icon: 'üü†',
        title: 'Gorduras baixas',
        message: `Voc√™ consumiu ${fatPercentage.toFixed(0)}% da meta de gorduras. Considere adicionar mais fontes de gordura saud√°vel.`
      });
    } else if (fatStatus === 'target') {
      insights.push({
        type: 'success',
        icon: '‚úÖ',
        title: 'Gorduras em dia!',
        message: `Excelente! Voc√™ atingiu ${fatPercentage.toFixed(0)}% da meta de gorduras.`
      });
    } else if (fatStatus === 'above') {
      insights.push({
        type: 'info',
        icon: 'üü°',
        title: 'Gorduras acima da meta',
        message: `Voc√™ consumiu ${fatPercentage.toFixed(0)}% da meta de gorduras. Est√° um pouco acima, mas ainda dentro do aceit√°vel.`
      });
    } else if (fatStatus === 'excess') {
      insights.push({
        type: 'warning',
        icon: '‚ö†Ô∏è',
        title: 'Gorduras em excesso',
        message: `Voc√™ consumiu ${fatPercentage.toFixed(0)}% da meta de gorduras. Considere reduzir a ingest√£o.`
      });
    }

    // An√°lise de calorias
    const kcalPercentage = (currentTotals.kcal / goals.kcal) * 100;
    const kcalStatus = getMacroStatus(kcalPercentage, 'caloria');
    
    if (kcalStatus === 'very-low') {
      insights.push({
        type: 'warning',
        icon: 'üî¥',
        title: 'Calorias muito baixas',
        message: `Voc√™ consumiu apenas ${kcalPercentage.toFixed(0)}% da meta cal√≥rica. Considere adicionar um lanche saud√°vel.`
      });
    } else if (kcalStatus === 'low') {
      insights.push({
        type: 'warning',
        icon: 'üü†',
        title: 'Calorias baixas',
        message: `Voc√™ consumiu ${kcalPercentage.toFixed(0)}% da meta cal√≥rica. Considere adicionar mais alimentos.`
      });
    } else if (kcalStatus === 'target') {
      insights.push({
        type: 'success',
        icon: '‚úÖ',
        title: 'Calorias em dia!',
        message: `Excelente! Voc√™ atingiu ${kcalPercentage.toFixed(0)}% da meta cal√≥rica.`
      });
    } else if (kcalStatus === 'above') {
      insights.push({
        type: 'info',
        icon: 'üü°',
        title: 'Calorias acima da meta',
        message: `Voc√™ consumiu ${kcalPercentage.toFixed(0)}% da meta cal√≥rica. Est√° um pouco acima, mas ainda dentro do aceit√°vel.`
      });
    } else if (kcalStatus === 'excess') {
      insights.push({
        type: 'warning',
        icon: '‚ö†Ô∏è',
        title: 'Calorias em excesso',
        message: `Voc√™ consumiu ${kcalPercentage.toFixed(0)}% da meta cal√≥rica. Considere reduzir por√ß√µes nas pr√≥ximas refei√ß√µes.`
      });
    }

    // An√°lise de √°gua
    const waterPercentage = (currentTotals.water_ml / goals.water_ml) * 100;
    const waterStatus = getMacroStatus(waterPercentage, '√°gua');
    
    if (waterStatus === 'very-low') {
      insights.push({
        type: 'warning',
        icon: 'üî¥',
        title: 'Hidrata√ß√£o muito baixa',
        message: `Voc√™ bebeu apenas ${waterPercentage.toFixed(0)}% da meta de √°gua. Lembre-se de beber √°gua regularmente.`
      });
    } else if (waterStatus === 'low') {
      insights.push({
        type: 'warning',
        icon: 'üü†',
        title: 'Hidrata√ß√£o baixa',
        message: `Voc√™ bebeu ${waterPercentage.toFixed(0)}% da meta de √°gua. Considere aumentar a ingest√£o de l√≠quidos.`
      });
    } else if (waterStatus === 'target') {
      insights.push({
        type: 'success',
        icon: '‚úÖ',
        title: 'Hidrata√ß√£o perfeita!',
        message: `Parab√©ns! Voc√™ atingiu ${waterPercentage.toFixed(0)}% da meta de hidrata√ß√£o.`
      });
    } else if (waterStatus === 'above') {
      insights.push({
        type: 'info',
        icon: 'üü°',
        title: 'Hidrata√ß√£o acima da meta',
        message: `Voc√™ bebeu ${waterPercentage.toFixed(0)}% da meta de √°gua. Est√° um pouco acima, mas ainda dentro do aceit√°vel.`
      });
    } else if (waterStatus === 'excess') {
      insights.push({
        type: 'warning',
        icon: '‚ö†Ô∏è',
        title: 'Hidrata√ß√£o em excesso',
        message: `Voc√™ bebeu ${waterPercentage.toFixed(0)}% da meta de √°gua. Considere reduzir a ingest√£o de l√≠quidos.`
      });
    }


    return insights;
  };

  const insights = getInsights();

  if (insights.length === 0) {
    return (
      <Card className="bg-green-50 border-green-200">
        <div className="text-center py-4">
          <div className="text-4xl mb-2">üéâ</div>
          <h3 className="text-lg font-semibold text-green-800">Excelente dia!</h3>
          <p className="text-green-600">Voc√™ est√° no caminho certo com sua nutri√ß√£o!</p>
        </div>
      </Card>
    );
  }

  return (
    <div className="space-y-4">
      <h3 className="text-lg font-semibold text-gray-900 flex items-center">
        <span className="mr-2">üß†</span>
        Insights Inteligentes
      </h3>
      
      <div className="space-y-3">
        {insights.map((insight, index) => (
          <Card
            key={index}
            className={`${
              insight.type === 'success' ? 'bg-green-50 border-green-200' :
              insight.type === 'warning' ? 'bg-yellow-50 border-yellow-200' :
              insight.type === 'info' ? 'bg-blue-50 border-blue-200' :
              'bg-gray-50 border-gray-200'
            }`}
          >
            <div className="flex items-start space-x-3">
              <span className="text-2xl">{insight.icon}</span>
              <div className="flex-1">
                <h4 className={`font-medium ${
                  insight.type === 'success' ? 'text-green-800' :
                  insight.type === 'warning' ? 'text-yellow-800' :
                  insight.type === 'info' ? 'text-blue-800' :
                  'text-gray-800'
                }`}>
                  {insight.title}
                </h4>
                <p className={`text-sm ${
                  insight.type === 'success' ? 'text-green-600' :
                  insight.type === 'warning' ? 'text-yellow-600' :
                  insight.type === 'info' ? 'text-blue-600' :
                  'text-gray-600'
                }`}>
                  {insight.message}
                </p>
              </div>
            </div>
          </Card>
        ))}
      </div>
    </div>
  );
};

